{% extends "base.html" %}
{% block title %}lieu (single){% endblock %}

{% block content %}

<div class="row">
  <div id="map" style="width:100%; height: 300px;"></div>
</div>

<div class="row">

<table border="1">
  {% include "inc_lieu_doc_row.html" %}
</table>

<script type="text/javascript">

window.addEventListener("load", function load(event){

	var els = document.getElementsByClassName("lieu-result");
	var principal = els[0];

	var lat = principal.getAttribute("data-lieu-latitude");
	var lon = principal.getAttribute("data-lieu-longitude");
	var id = principal.getAttribute("id");
	var zoom = 18;

	var map = mapzen.whosonfirst.leaflet.tangram.map_with_latlon('map', lat, lon, zoom);

	//

	var feature = {
		"type": "Feature",
		"geometry": { "type": "Point", "coordinates": [ lon, lat ] },
		"properties": { "id": id, "lflt:label_text": id },
	};

	var style = {
		"color": "#000",
		"weight": 3,
		"opacity": 1,
		"radius": 10,
		"fillColor": "#b0c4de",
		"fillOpacity": 0.8
	};

	var handler = mapzen.whosonfirst.leaflet.handlers.point(style);

	mapzen.whosonfirst.leaflet.draw_point(map, feature, style, handler);

	var possible = {
		"exact_dupe" : "#8fbc8f",
		"likely_dupe" : "#fafad2",
		"needs_review" : "#ffffff",
	};

	for (p in possible){

		var class_name = "lieu-classification-" + p;
		// console.log("CLASS", class_name);

		var features = [];

		var els = document.getElementsByClassName(class_name);
		var count = els.length;

		for (var i=0; i < count; i++){

			var el = els[i];
			var lat = el.getAttribute("data-lieu-latitude");
			var lon = el.getAttribute("data-lieu-longitude");
			var id = el.getAttribute("id");

			var feature = {
				"type": "Feature",
				"geometry": { "type": "Point", "coordinates": [ lon, lat ] },
				"properties": { "id": id, "lflt:label_text": id },
			};

			features.push(feature);			  
		}

		var col = {
			"type": "FeatureCollection",
			"features": features,  
		};

		var style = {
			"color": "#000",
			"weight": 2,
			"opacity": 1,
			"radius": 5,
			"fillColor": possible[p],
			"fillOpacity": 0.8
		};

		var handler = mapzen.whosonfirst.leaflet.handlers.point(style);
		mapzen.whosonfirst.leaflet.draw_point(map, col, style, handler);
	}
			  
});

</script>

{% endblock %}
